{
    "id": "ADCFA1C1-3BE7-45FC-871F-13634B2CFF1D",
    "name": "DockerCompose",
    "friendlyName": "Docker Compose (preview)",
    "description": "Build, push or run multi-container Docker applications",
	"helpMarkDown": "[More Information](http://aka.ms/dockertoolsforvsts)",
    "category": "Build",
	"visibility": [
        "Build",
        "Release"
    ],
    "author": "Microsoft Corporation",
    "version": {
        "Major": 0,
        "Minor": 1,
        "Patch": 15
    },
    "demands": [],
    "groups": [
        {
            "name": "advanced",
            "displayName": "Advanced Options",
            "isExpanded": false
        }
    ],
    "inputs": [
        {
            "name": "dockerHostEndpoint",
            "type": "connectedService:dockerhost",
            "label": "Docker Host Connection",
            "helpMarkDown": "Select a Docker host connection. Defaults to the agent's host.",
            "groupName": "advanced"
        },
        {
            "name": "dockerRegistryEndpoint",
            "type": "connectedService:dockerregistry",
            "label": "Docker Registry Connection",
            "helpMarkDown": "Select a Docker registry connection. Only required for commands that need to authenticate with a registry."
        },                
        {
            "name": "dockerComposeFile",
            "type": "filePath",
            "label": "Docker Compose File",
            "defaultValue": "**/docker-compose.yml",
            "required": true,
            "helpMarkDown": "Path to the primary Docker Compose file to use."
        },
        {
            "name": "additionalDockerComposeFiles",
            "type": "multiLine",
            "properties": {
                "resizable": "true",
                "rows": "2"
            },
            "label": "Additional Docker Compose Files",
            "helpMarkDown": "Additional Docker Compose files to be combined with the primary Docker Compose file. Relative paths are resolved relative to the directory containing the primary Docker Compose file. If a specified file is not found, it is ignored. Specify each file path on a new line."
        },
        {
            "name": "dockerComposeFileArgs",
            "type": "multiLine",
            "properties": {
                "resizable": "true",
                "rows": "2"
            },
            "label": "Environment Variables",
            "helpMarkDown": "Environment variables to be set during the command. Specify each name=value pair on a new line."
        },
        {
            "name": "projectName",
            "type": "string",
            "label": "Project Name",
            "helpMarkDown": "Alternate project name. Defaults to the name of the current working directory."
        },
        {
            "name": "action",
            "type": "pickList",
            "label": "Action",
            "required": true,
            "options": {
                "Build services": "Build services",
                "Push services": "Push services",
                "Run services": "Run services",
                "Combine files": "Combine files",
                "Run a command": "Run a command"
            },
            "defaultValue": "Run a command",
            "helpMarkDown": "Select a Docker Compose action."
        },
        {
            "name": "additionalImageTags",
            "type": "multiLine",
            "properties": {
                "resizable": "true",
                "rows": "2"
            },
            "label": "Additional Image Tags",
            "defaultValue": "$(Build.SourceVersion)\n$(Build.SourceBranchName)",
            "visibleRule": "action = Build services || action = Push services",
            "helpMarkDown": "Additional tags for the Docker images being built or pushed."
        },
        {
            "name": "includeGitTags",
            "type": "boolean",
            "label": "Include Git Tags",
            "defaultValue": "true",
            "visibleRule": "action = Build services || action = Push services",
            "helpMarkDown": "Include Git tags when building or pushing Docker images."
        },
        {
            "name": "includeLatestTag",
            "type": "boolean",
            "label": "Include Latest Tag",
            "defaultValue": "true",
            "visibleRule": "action = Build services || action = Push services",
            "helpMarkDown": "Include the 'latest' tag when building or pushing Docker images."
        },
        {
            "name": "writeImageDigests",
            "type": "boolean",
            "label": "Write Image Digests",
            "defaultValue": "true",
            "visibleRule": "action = Combine files",
            "helpMarkDown": "Lock down image references by replacing them with their registry-qualified names and full repository digests."
        },
        {
            "name": "outputDockerComposeFile",
            "type": "filePath",
            "label": "Output Docker Compose File",
            "defaultValue": "$(Build.StagingDirectory)/docker-compose.yml",
            "visibleRule": "action = Combine files",
            "helpMarkDown": "Path to an output Docker Compose file."
        },
        {
            "name": "buildImages",
            "type": "boolean",
            "label": "Build Images",
            "defaultValue": "true",
            "visibleRule": "action = Run services",
            "helpMarkDown": "Build images before starting containers."
        },
        {
            "name": "dockerComposeCommand",
            "type": "string",
            "label": "Command",
            "required": true,
            "visibleRule": "action = Run a command",
            "helpMarkDown": "Docker Compose command to execute with arguments. For example, 'rm --all' to remove all stopped service containers."
        },
        {
            "name": "cwd",
            "type": "filePath",
            "label": "Working Directory",
            "defaultValue": "$(System.DefaultWorkingDirectory)",
            "helpMarkDown": "Working directory for the Docker Compose command.",
            "groupName": "advanced"
        }
    ],
    "instanceNameFormat": "Docker Compose: $(action)",
    "execution": {
        "Node": {
            "target": "invokeDockerComposeAction.js",
            "argumentFormat": ""
        }
    }
}